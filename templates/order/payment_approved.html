{% load static humanize %} 
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Đặt hàng thành công</title>

    <link rel="stylesheet" href="{% static 'base/header.css' %}">
    <link rel="stylesheet" href="{% static 'base/footer.css' %}">
    <link rel="stylesheet" href="{% static 'order/payment_approved.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

{% include "base/header.html" %}

<main class="main-content">

    <div class="confirmation-container">
            
        <div class="card success-card">
            <i class="fa-solid fa-circle-check"></i>
            <h1>ĐẶT HÀNG THÀNH CÔNG!</h1>
            <p>Đơn hàng của bạn đã được tiếp nhận và đang chờ xử lý.</p>
            <p>Mã đơn hàng: <strong>#DH{{ order.id }}</strong></p>
            <p>Một email xác nhận đã được gửi đến địa chỉ của bạn.</p>
            
            <div class="confirmation-actions">
                <a href="{% url 'home:home' %}" class="order-btn primary-btn">
                    Tiếp tục mua sắm
                </a>
                <a href="{% url 'order:order_history' %}" class="order-btn secondary-btn">
                    Xem Lịch sử Đơn hàng
                </a>
            </div>
        </div>
        
        <div class="card">
            <h2>Tóm tắt đơn hàng</h2>
            
            <div class="summary-details">
                <div class="detail-row">
                    <strong>Ngày đặt:</strong>
                    <span>{{ order.created_at|date:"d/m/Y" }}</span>
                </div>
                <div class="detail-row">
                    <strong>Phương thức thanh toán:</strong>
                    <span>{{ order.get_payment_method_display }}</span>
                </div>
                <div class="detail-row">
                    <strong>Địa chỉ giao hàng:</strong>
                    <span>{{ order.shipping_address }}</span>
                </div>
            </div>

            <div class="summary-row">
                <span>Tạm tính</span>
                <span>{{ raw_total|floatformat:0 }}₫</span>
            </div>
            
            <div class="summary-row">
                <span>Phí vận chuyển</span>
                <span>{{ order.shipping_fee|default:15000|floatformat:0 }}₫</span>
            </div>
            
            <div class="summary-row discount-row">
                <span>Giảm giá (Voucher/Promo)</span>
                <span>- {{ order.discount_amount|default:0|floatformat:0 }}₫</span>
            </div>

            <div class="summary-row total">
                <strong>TỔNG THANH TOÁN:</strong>
                <strong>{{ final_total|floatformat:0 }}₫</strong>
            </div>
        </div>

        <div class="card">
            <h3>Sản phẩm đã đặt</h3>

            {% for item in order.items.all %}
                <div class="product">
                    <img
                        src="{% if item.book.images.first %}
                                {{ item.book.images.first.image.url }}
                             {% else %}
                                https://via.placeholder.com/60
                             {% endif %}"
                        class="product-img"
                    >

                    <div class="product-right">
                        <p class="product-title">{{ item.book.title }}</p>
                        <div class="product-bottom">
                            <strong>{{ final_total|floatformat:0|intcomma}}₫</strong>
                            <span>x {{ item.quantity }}</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>

</main>

{% include "base/footer.html" %}

</body>
</html>
