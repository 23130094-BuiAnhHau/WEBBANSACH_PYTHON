{% load static humanize %} 
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh S√°ch S√°ch - BookStore</title>


    <link rel="stylesheet" href="{% static 'base/header.css' %}">
    <link rel="stylesheet" href="{% static 'base/footer.css' %}">

    
    <link rel="stylesheet" href="{% static 'book/book_list.css' %}"
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

{% include "base/header.html" %}

<main class="main-content">

    <div class="container">

        {% if request.GET.category %}


        <h1 class="page-title">
            Danh m·ª•c: {{ current_category.name }}
        </h1>

        <div class="books-grid">
            {% for book in books %}
                <a href="{% url 'book:book_detail' book.id %}" class="book-card">
                    <div class="book-image">
                        {% if book.images.first %}
                            <img src="{{ book.images.first.image }}" alt="{{ book.title }}">
                        {% else %}
                            <img src="https://via.placeholder.com/250x300/2e7d32/ffffff?text={{ book.title|slice:":12" }}">
                        {% endif %}

                    </div>

                    <div class="book-info">
                        <h3 class="book-title">{{ book.title }}</h3>
                        <p class="book-author">{{ book.author.name }}</p>

                        <div class="book-price">
                            {{ book.get_display_price_formatted }} ƒë
                        </div>

                        {% if user.is_authenticated %}
                        <div class="book-actions">
                            <form method="POST"
                                action="{% url 'cart:add_to_cart' book.id %}"
                                onclick="event.stopPropagation(); event.preventDefault();">
                                {% csrf_token %}
                                <button type="submit" class="add-to-cart-btn">
                                    üõí Th√™m v√†o gi·ªè
                                </button>
                            </form>

                            <button class="view-detail-btn"
                                    onclick="event.stopPropagation();
                                    location.href='{% url 'book:book_detail' book.id %}'">
                                üëÅÔ∏è Xem
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </a>
            {% empty %}
                <p>Danh m·ª•c n√†y hi·ªán ch∆∞a c√≥ s√°ch.</p>
            {% endfor %}
        </div>

        {% else %}
        

        <h1 class="page-title">T·∫•t c·∫£ s√°ch</h1>

        {% for category in categories %}
            {% with category.books.all as category_books %}
                {% if category_books %}
                <section class="category-section">
                    <h2 class="category-title">üìÅ {{ category.name }}</h2>

                    <div class="books-grid">
                        {% for book in category_books %}
                            <a href="{% url 'book:book_detail' book.id %}" class="book-card">
                                <div class="book-image">
                                    {% if book.images.first %}
                                        <img src="{{ book.images.first.image }}">
                                    {% else %}
                                        <img src="https://via.placeholder.com/250x300">
                                    {% endif %}
                                </div>

                                <div class="book-info">
                                    <h3>{{ book.title }}</h3>
                                    <p>{{ book.author.name }}</p>
                                    <div class="book-price">
                                        {{ book.get_display_price_formatted}} ƒë
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}
            {% endwith %}
        {% endfor %}

        {% endif %}

    </div>
</main>

{% include "base/footer.html" %}

<script>
    let searchTimeout;
    const searchInput = document.querySelector('input[name="search"]');
    if (searchInput) {
        searchInput.addEventListener('input', function () {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                this.form.submit();
            }, 500);
        });
    }

    document.querySelectorAll('.book-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 50);
    });

    document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
            e.stopPropagation();
            const originalText = this.innerHTML;
            this.innerHTML = '‚è≥ ƒêang th√™m...';
            this.disabled = true;

            setTimeout(() => {
                this.innerHTML = ' ƒê√£ th√™m!';
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 1500);
            }, 500);
        });
    });
</script>

</body>
</html>
