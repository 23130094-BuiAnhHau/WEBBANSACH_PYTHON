{% load static %}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Viết đánh giá - {{ book.title }}</title>

    <!-- CSS chung -->
    <link rel="stylesheet" href="{% static 'base/header.css' %}">
    <link rel="stylesheet" href="{% static 'base/footer.css' %}">

    <!-- Bootstrap + Icon -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- CSS riêng -->
    <link rel="stylesheet" href="{% static 'book/add_review.css' %}">
</head>

<body>

<!-- HEADER -->
{% include "base/header.html" %}

<main class="main-content">

    <div class="container py-5">

        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="text-primary">
                <i class="fas fa-star me-2"></i>VIẾT ĐÁNH GIÁ
            </h1>
            <p class="text-muted">Chia sẻ cảm nhận của bạn về cuốn sách</p>
        </div>

        <!-- Thông tin sách -->
        <div class="card book-card shadow mb-4">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-3 text-center">
                        <div class="bg-light rounded p-3">
                            <i class="fas fa-book fa-3x text-primary"></i>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <h4 class="card-title text-primary">{{ book.title }}</h4>
                        <p class="mb-1">
                            <i class="fas fa-user text-muted me-2"></i>
                            <strong>Tác giả:</strong> {{ book.author.name }}
                        </p>
                        <p class="mb-1">
                            <i class="fas fa-tag text-muted me-2"></i>
                            <strong>Thể loại:</strong> {{ book.category.name }}
                        </p>
                        <p class="mb-0">
                            <i class="fas fa-star text-warning me-2"></i>
                            <strong>Điểm trung bình:</strong>
                            <span class="badge bg-info">
                                {{ book.average_rating|floatformat:1 }}/5
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Thông báo -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}

        <!-- Form đánh giá -->
        <div class="card shadow">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-edit text-primary me-2"></i>
                    Đánh giá của bạn
                </h5>
            </div>

            <div class="card-body">
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-4 text-center">
                        <label class="form-label fw-bold mb-3 d-block">
                            <i class="fas fa-star text-warning me-1"></i>
                            Chọn số sao
                        </label>

                        <div class="star-rating d-flex justify-content-center">
                            {% for i in "54321" %}
                                <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}"
                                    {% if forloop.first %}checked{% endif %}>
                                <label for="star{{ i }}">
                                    <i class="fas fa-star"></i>
                                </label>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-comment-dots text-primary me-1"></i>
                            Nội dung đánh giá
                        </label>
                        <textarea class="form-control" name="comment" rows="5" required></textarea>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'book:book_detail' book.id %}" class="btn btn-outline-secondary">
                            ← Quay lại
                        </a>
                        <button type="submit" class="btn btn-primary">
                            Gửi đánh giá
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

</main>

<!-- FOOTER -->
{% include "base/footer.html" %}

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const stars = document.querySelectorAll(".star-rating label");

    stars.forEach(star => {
        star.addEventListener("click", function () {
            const value = this.getAttribute("for").replace("star", "");
            stars.forEach(s => {
                const v = s.getAttribute("for").replace("star", "");
                s.style.color = v <= value ? "#ffc107" : "#ddd";
            });
        });
    });
});
</script>

</body>
</html>
