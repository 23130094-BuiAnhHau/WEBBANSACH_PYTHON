<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Viết đánh giá - BookStore</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'book/add_review.css' %}" />
  </head>
  <body>
    <div class="container py-5">
      <!-- Header -->
      <div class="text-center mb-4">
        <h1 class="text-primary">
          <i class="fas fa-star me-2"></i>VIẾT ĐÁNH GIÁ
        </h1>
        <p class="text-muted">Chia sẻ cảm nhận của bạn về cuốn sách</p>
      </div>

      <!-- Thông tin sách -->
      <div class="card book-card shadow mb-4">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-3 text-center">
              <div class="bg-light rounded p-3">
                <i class="fas fa-book fa-3x text-primary"></i>
              </div>
            </div>
            <div class="col-md-9">
              <h4 class="card-title text-primary">{{ book.title }}</h4>
              <p class="card-text mb-1">
                <i class="fas fa-user text-muted me-2"></i>
                <strong>Tác giả:</strong> {{ book.author.name }}
              </p>
              <p class="card-text mb-1">
                <i class="fas fa-tag text-muted me-2"></i>
                <strong>Thể loại:</strong> {{ book.category.name }}
              </p>
              <p class="card-text mb-0">
                <i class="fas fa-star text-warning me-2"></i>
                <strong>Điểm trung bình:</strong>
                <span class="badge bg-info"
                  >{{ book.average_rating|floatformat:1 }}/5</span
                >
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Thông báo lỗi -->
      {% if messages %} {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
        {% if message.tags == 'error' %}
        <i class="fas fa-exclamation-triangle me-2"></i>
        {% elif message.tags == 'success' %}
        <i class="fas fa-check-circle me-2"></i>
        {% elif message.tags == 'warning' %}
        <i class="fas fa-exclamation-circle me-2"></i>
        {% endif %} {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %} {% endif %}

      <!-- Form đánh giá -->
      <div class="card shadow">
        <div class="card-header bg-white border-bottom">
          <h5 class="mb-0">
            <i class="fas fa-edit text-primary me-2"></i>
            Đánh giá của bạn
          </h5>
        </div>

        <div class="card-body">
          <form method="POST">
            {% csrf_token %}

            <!-- Rating stars -->
            <div class="mb-4">
              <label class="form-label fw-bold mb-3 d-block">
                <i class="fas fa-star text-warning me-1"></i>
                Chọn số sao:
              </label>
              <div class="star-rating d-flex justify-content-center">
                {% for i in "54321" %}
                <input
                  type="radio"
                  id="star{{ i }}"
                  name="rating"
                  value="{{ i }}"
                  {%
                  if
                  forloop.first
                  %}checked{%
                  endif
                  %}
                />
                <label for="star{{ i }}" title="{{ i }} sao">
                  <i class="fas fa-star"></i>
                </label>
                {% endfor %}
              </div>
              <div class="text-center mt-2">
                <small class="text-muted">
                  1 sao = Rất tệ | 3 sao = Bình thường | 5 sao = Tuyệt vời
                </small>
              </div>
            </div>

            <!-- Comment -->
            <div class="mb-4">
              <label for="comment" class="form-label fw-bold">
                <i class="fas fa-comment-dots text-primary me-1"></i>
                Nội dung đánh giá:
              </label>
              <textarea
                class="form-control"
                id="comment"
                name="comment"
                rows="5"
                placeholder="Hãy chia sẻ chi tiết về cuốn sách này. Bạn thích/không thích điều gì? Sách có đáng đọc không?"
                required
              ></textarea>
              <div class="form-text mt-2">
                <i class="fas fa-lightbulb text-info me-1"></i>
                Đánh giá chi tiết giúp người khác đưa ra quyết định tốt hơn.
              </div>
            </div>

            <!-- Nút hành động -->
            <div class="d-flex justify-content-between pt-3">
              <a
                href="{% url 'book:book_detail' book.id %}"
                class="btn btn-outline-secondary px-4"
              >
                <i class="fas fa-arrow-left me-2"></i>Quay lại
              </a>
              <button type="submit" class="btn btn-primary px-4 btn-review">
                <i class="fas fa-paper-plane me-2"></i>Gửi đánh giá
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer note -->
      <div class="text-center mt-4">
        <p class="text-muted small">
          <i class="fas fa-info-circle me-1"></i>
          Chỉ những khách hàng đã mua sách mới có thể đánh giá.
        </p>
      </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // JavaScript cho rating stars
      document.addEventListener("DOMContentLoaded", function () {
        const stars = document.querySelectorAll(".star-rating label");
        const inputs = document.querySelectorAll(".star-rating input");

        stars.forEach((star) => {
          star.addEventListener("click", function () {
            const ratingValue = this.getAttribute("for").replace("star", "");

            // Cập nhật trạng thái visual
            stars.forEach((s) => {
              const starValue = s.getAttribute("for").replace("star", "");
              if (starValue <= ratingValue) {
                s.style.color = "#ffc107";
              } else {
                s.style.color = "#ddd";
              }
            });
          });
        });

        // Khởi tạo star mặc định (5 sao)
        stars.forEach((star) => {
          const starValue = star.getAttribute("for").replace("star", "");
          if (starValue <= 5) {
            star.style.color = "#ffc107";
          }
        });
      });
    </script>
  </body>
</html>
